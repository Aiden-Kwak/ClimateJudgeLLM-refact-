## Project Folder Structure

```bash
.
├── controller
│   └── main_controller.py
├── judge_input.json
├── judge_verdict.txt
├── jury_results.json
├── model
│   ├── data_models.py
│   └── llm_model.py
├── reply_brief
│   ├── lawyer_reply_brief.txt
│   └── prosecutor_reply_brief.txt
├── results # Automatically generated
│   ├── lawyer_results.txt
│   └── prosecutor_results.txt
├── rscFiles
│   └── Files(pdfs)
├── rscFilesIndex # Automatically generated by rscFiles
│   ├── faiss_index.bin
│   └── metadata.json
├── runs.py # Entry point
├── service
│   ├── __pycache__
│   ├── base_agent.py
│   ├── judge_service.py
│   ├── jury_service.py
│   ├── lawyer_service.py
│   ├── prompt_builders
│   ├── prosecutor_service.py
│   ├── qa_service.py
│   └── rag_service.py
└── view
    ├── console_view.py
    └── file_view.py
```

## UML
<img src="docs/llm_puml.png" width="900px">

## Execution flow

```mermaid

sequenceDiagram
    participant User
    participant MainController
    participant ConsoleView
    participant QAService
    participant RagIndexService
    participant JuryService
    participant LawyerService
    participant ProsecutorService
    participant JudgeService
    participant FileView

    User->>MainController: run(claim, data_folder)

    MainController->>ConsoleView: print_info("세부 질문 생성 중...")
    MainController->>QAService: generate_questions(claim)
    QAService-->>MainController: questions

    MainController->>ConsoleView: print_info("리소스 임베딩 중... 폴더=data_folder")
    MainController->>RagIndexService: embed_resources(data_folder)
    RagIndexService-->>MainController: resource

    MainController->>ConsoleView: print_info("배심원단 평가 중...")
    MainController->>JuryService: evaluate(questions, resource, claim)
    JuryService-->>MainController: jury_results
    MainController->>FileView: write_json("jury_results.json", jury_results)

    MainController->>ConsoleView: print_info("변호사 의견 생성 중...")
    MainController->>LawyerService: analyze("jury_results.json", claim, "gpt-3.5-turbo")
    LawyerService-->>MainController: lawyer_text
    MainController->>FileView: write_text("results/lawyer_results.txt", lawyer_text)

    MainController->>ConsoleView: print_info("검사 의견 생성 중...")
    MainController->>ProsecutorService: analyze("jury_results.json", claim, "gpt-3.5-turbo")
    ProsecutorService-->>MainController: prosecutor_text
    MainController->>FileView: write_text("results/prosecutor_results.txt", prosecutor_text)

    MainController->>ConsoleView: print_info("검사가 변호사의 의견을 검토 중...")
    MainController->>ProsecutorService: reply_brief("results/lawyer_results.txt", claim, "gpt-3.5-turbo")
    ProsecutorService-->>MainController: prosecutor_reply
    MainController->>FileView: write_text("reply_brief/prosecutor_reply_brief.txt", prosecutor_reply)

    MainController->>ConsoleView: print_info("변호사가 검사의 리플라이 브리프를 검토 중...")
    MainController->>LawyerService: reply_brief("reply_brief/prosecutor_reply_brief.txt", claim, "gpt-3.5-turbo")
    LawyerService-->>MainController: lawyer_reply
    MainController->>FileView: write_text("reply_brief/lawyer_reply_brief.txt", lawyer_reply)

    MainController->>ConsoleView: print_info("판사 의견 생성 중...")
    MainController->>JudgeService: prepare_input(
        jury_path="jury_results.json",
        lawyer_results_path="results/lawyer_results.txt",
        prosecutor_results_path="results/prosecutor_results.txt",
        lawyer_reply_path="reply_brief/lawyer_reply_brief.txt",
        prosecutor_reply_path="reply_brief/prosecutor_reply_brief.txt"
    )
    JudgeService-->>MainController: judge_input
    MainController->>FileView: write_json("judge_input.json", judge_input)

    MainController->>JudgeService: decide("judge_input.json", "gpt-3.5-turbo")
    JudgeService-->>MainController: verdict
    MainController->>FileView: write_text("judge_verdict.txt", verdict)

```