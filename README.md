## 1. Overview
<details>
<summary>ğŸ‡°ğŸ‡· í•œêµ­ì–´ ì„¤ëª…</summary>
> ë³¸ í”„ë¡œê·¸ë¨ì€ ë²•ì •(Court)ì„ ëª¨ë°©í•´ ì‚¬ìš©ì ì…ë ¥(ê¸°í›„ ë³€í™”ì— ëŒ€í•œ ì£¼ì¥)ì„ íŒë‹¨í•˜ê³  ìµœì¢… íŒê²°ë¬¸ì„ Latex í˜•ì‹ìœ¼ë¡œ ë½‘ì•„ PDFë¥¼ ìƒì„±í•œë‹¤.

ê¸°í›„ë³€í™”ì— ëŒ€í•œ ë…¼ì˜ëŠ” ê³¼í•™Â·ì •ì±…Â·ì‚¬íšŒ ì „ë°˜ì— ê±¸ì³ ë§¤ìš° ë³µì¡í•˜ê²Œ ì–½í˜€ ìˆë‹¤. ì§€êµ¬ ì˜¨ë‚œí™” í˜„ìƒì„ íš¨ê³¼ì ìœ¼ë¡œ ì™„í™”í•˜ê¸° ìœ„í•´ì„œëŠ” êµ­ê°€ ê°„, ì„¸ëŒ€ ê°„, ì‚°ì—…ê³„Â·í•™ê³„Â·ì‹œë¯¼ì‚¬íšŒê°€ ëª¨ë‘ ë™ì˜í•˜ëŠ” ì •ì±…ì  í•©ì˜ê°€ í•„ìˆ˜ì ì´ë‹¤. ê·¸ëŸ¬ë‚˜ í˜„ì¥ì—ì„œ ì œê¸°ë˜ëŠ” ë‹¤ì–‘í•œ ì£¼ì¥ê³¼ ë°˜ë¡ ë“¤ì€ ì „ë¬¸ì„±ì´ ìš”êµ¬ë˜ê³ , ì¼ë°˜ì¸ë“¤ì´ ì´ë¥¼ ì¢…í•©ì ìœ¼ë¡œ ì´í•´í•˜ê¸°ë€ ì‚¬ì‹¤ìƒ ì‰½ì§€ ì•Šë‹¤. ê·¸ ê²°ê³¼, ê¸°í›„ë³€í™” ì´ìŠˆì— ì§ë©´í•œ ê°œì¸ì´ë‚˜ ê³µë™ì²´ëŠ” ì •ë³´ ê³¼ë¶€í•˜ì— ë¹ ì§€ê±°ë‚˜, ê²€ì¦ë˜ì§€ ì•Šì€ ì£¼ì¥ì— ì˜¤íˆë ¤ íšŒì˜ê°ì„ ëŠë¼ëŠ” ë„ì „ì  ìƒí™©ì— ë†“ì´ê³¤ í•œë‹¤.

ì˜ˆì»¨ëŒ€, ë‹¤ìŒê³¼ ê°™ì€ ì£¼ì¥ì„ ì‚´í´ë³´ì.

> â€œì§€êµ¬ ì˜¨ë‚œí™”ëŠ” ê¸°í›„ ëª¨ë¸ì´ ì˜ˆì¸¡í•œ ë§Œí¼ ì§„í–‰ë˜ì§€ ì•Šê³  ìˆë‹¤. ì´ëŠ” ì‹ë¬¼ì˜ ê´‘í•©ì„±ì´ ì˜ˆìƒë³´ë‹¤ ë” ë§ì€ COâ‚‚ë¥¼ í¡ìˆ˜í•˜ê³  ìˆê¸° ë•Œë¬¸ì´ë‹¤. ê¸°í›„ ë³€í™”ëŠ” ê±°ì§“ë§ì´ë‹¤.â€

ì´ì™€ ê°™ì€ ì£¼ì¥ì€
1. ê³¼í•™ì  ê·¼ê±°ì˜ ë³µì¡ì„± (ì—¬ëŸ¬ ê¸°í›„ ëª¨ë¸ê³¼ ê´€ì¸¡ì¹˜ì˜ í•´ì„ ì°¨ì´)
2. ë°ì´í„° í•´ì„ì˜ í¸í–¥ ê°€ëŠ¥ì„± (íŠ¹ì • ì—°êµ¬ê²°ê³¼ë§Œ ê°•ì¡°)
3. ì¼ë°˜ ë…ìì˜ ì •ë³´ ì ‘ê·¼ì„± í•œê³„ë¥¼ ëª¨ë‘ ë™ì‹œì— ë‚´í¬í•˜ê³  ìˆë‹¤.

í•„ìëŠ” ê¸°í›„ë³€í™” ì •ë³´ì˜ ë³µì¡ì„±ê³¼ ì¼ë°˜ ëŒ€ì¤‘ì˜ ì ‘ê·¼ì„± í•œê³„ë¥¼ ë™ì‹œì— í•´ê²°í•˜ê¸° ìœ„í•´, ë³¸ ì—°êµ¬ì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ RAG ê¸°ë°˜ LLM ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œì„ ì œì•ˆÂ·êµ¬ì¶•í•œë‹¤.
> 1. ë²•ì • ëª¨ë°©(Court Simulation) ì¸í„°í˜ì´ìŠ¤
> - ì‚¬ìš©ì ì§ˆë¬¸ì„ â€œì›ê³ (ì£¼ì¥) ì œê¸° â†’ ë°°ì‹¬ì›(ë°ì´í„°) í‰ê°€, ì§ˆë¬¸ í™•ì¥ â†’ ë³€í˜¸Â·ê²€ì‚¬(ì°¬ë°˜ ë…¼ë¦¬) ë³€ë¡  â†’ íŒì‚¬(ìš”ì•½Â·ê²°ë¡ )â€ì˜ ì ˆì°¨ë¡œ ìˆœì°¨ ì²˜ë¦¬
> 2. IPCC ë³´ê³ ì„œ ì „ ì²´ê³„ ì¸ìš© ë° ê²€ìƒ‰
> - ê³¼ê±° ì œ1ì°¨ ë³´ê³ ì„œë¶€í„° ìµœì‹  ë³´ê³ ì„œ, íŠ¹ë³„ ë³´ê³ ì„œ(e.g. Global Warming of 1.5Â°C)ê¹Œì§€ pdf ì „ ë‚´ìš©ì„ ë©”íƒ€ë°ì´í„°ì™€ í•¨ê»˜ ìƒ‰ì¸í•œë‹¤.
> - RAG(Retrieval-Augmented Generation) ê¸°ë²•ìœ¼ë¡œ ì‚¬ìš©ìì˜ ì§ˆì˜ ì˜ë„ì— ë§ëŠ” ë¬¸ë‹¨Â·ìˆ˜ì¹˜Â·ì¸ìš©ë¬¸ì„ ì°¾ì•„ í”„ë¡¬í”„íŠ¸ì— ì œê³µí•œë‹¤.
> 3. ìµœì¢…ì ìœ¼ë¡œ ì˜ëª»ëœ ì •ë³´ì™€ ê³¼ì¥Â·ì™œê³¡ëœ í•´ì„ì„ íŒë³„í•  ìˆ˜ ìˆëŠ” í‰ê°€ì§€í‘œ(Accuracy, Misleading, Overgeneralization, Unsupported, Inaccurate) ì²´ê³„ë¥¼ ì œì•ˆí•œë‹¤.
</details>

<details>
<summary>ğŸ‡¬ğŸ‡§ English description</summary>

> This program simulates a court to evaluate user input (claims about climate change) and generate a final verdict in LaTeX format as a PDF.

Discussions around climate change are deeply intertwined across scientific, policy, and social domains. To effectively mitigate global warming, policy consensus among nations, generations, industries, academia, and civil society is essential. However, the diverse claims and counterarguments that arise in the field require specialist knowledge, making it practically impossible for the general public to fully understand them. As a result, individuals or communities facing climate change issues may experience information overload or become skeptical of unverified claims, placing them in a challenging situation.

For example, consider the following claim:

> â€œGlobal warming is not proceeding as predicted by climate models. This is because plants are absorbing more COâ‚‚ through photosynthesis than expected. Climate change is a hoax.â€

Such a claim encompasses all of the following at once:
1. The complexity of scientific evidence (differences in interpretation among various climate models and observations)  
2. Potential bias in data interpretation (emphasizing specific research findings)  
3. Accessibility limits for general readers  

To address both the complexity of climate information and the accessibility challenge for the general public, this study proposes and builds the following RAG-based LLM agent system.  
> 1. Court Simulation Interface  
> - Sequentially processes user queries through the steps â€œPlaintiff (Claim) â†’ Jury (Data) Evaluation & Question Expansion â†’ Defense/Prosecution (Arguments for and against) â†’ Judge (Summary & Conclusion)â€  
> 2. Comprehensive Citation & Retrieval of IPCC Reports  
> - Indexes all content from the First Assessment Report to the latest reports and special reports (e.g., *Global Warming of 1.5Â°C*) along with metadata.  
> - Uses Retrieval-Augmented Generation (RAG) to find paragraphs, data, and citations that match the userâ€™s query intent and supplies them to the prompt.  
> 3. Evaluation Framework  
> - Proposes a system of metrics (Accuracy, Misleading, Overgeneralization, Unsupported, Inaccurate) to identify false information and exaggerated or distorted interpretations.  
</details>

í•´ë‹¹ í”„ë¡œì íŠ¸ëŠ” ê¸°ê°œë°œí•˜ì˜€ë˜ easy-rag-llm ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì˜ì¡´í•©ë‹ˆë‹¤. (https://github.com/Aiden-Kwak/easy_rag_llm)



## 2. Requirements
* install
```bash
brew install --cask mactex # for Mac
pip install -r requirements.txt
```

* .env
```bash
OPENAI_API_KEY=...

DATA_FOLDER='./rscFiles'

CLAIM="Global warming is not progressing as predicted by climate models. This is because plant photosynthesis is absorbing more COâ‚‚ than expected. Climate change is a lie."
```

## 3. Project Folder Structure

```bash
.
â”œâ”€â”€ controller
â”‚   â””â”€â”€ main_controller.py
â”œâ”€â”€ judge_input.json # auto generated
â”œâ”€â”€ judge_verdict.txt # auto generated
â”œâ”€â”€ jury_results.json # auto generated
â”œâ”€â”€ model
â”‚   â”œâ”€â”€ data_models.py
â”‚   â””â”€â”€ llm_model.py
â”œâ”€â”€ reply_brief # auto generated
â”‚   â”œâ”€â”€ lawyer_reply_brief.txt
â”‚   â””â”€â”€ prosecutor_reply_brief.txt
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ results          # auto generated
â”‚   â”œâ”€â”€ lawyer_results.txt
â”‚   â”œâ”€â”€ prosecutor_results.txt
â”‚   â”œâ”€â”€ verdict.aux
â”‚   â”œâ”€â”€ verdict.log
â”‚   â”œâ”€â”€ verdict.pdf
â”‚   â”œâ”€â”€ verdict.tex
â”‚   â””â”€â”€ verdict_build.log
â”œâ”€â”€ rscFiles
â”‚   â”œâ”€â”€ IPCC reports (pdf)
â”œâ”€â”€ rscFilesIndex    # auto generated (faiss index)
â”‚   â”œâ”€â”€ faiss_index.bin
â”‚   â””â”€â”€ metadata.json
â”œâ”€â”€ runs.py          # entry point
â”œâ”€â”€ service
â”‚   â”œâ”€â”€ base_agent.py
â”‚   â”œâ”€â”€ judge_service.py
â”‚   â”œâ”€â”€ jury_clean_service.py
â”‚   â”œâ”€â”€ jury_service.py
â”‚   â”œâ”€â”€ lawyer_service.py
â”‚   â”œâ”€â”€ pdf_service.py
â”‚   â”œâ”€â”€ prompt_builders
â”‚   â”œâ”€â”€ prosecutor_service.py
â”‚   â”œâ”€â”€ qa_service.py
â”‚   â””â”€â”€ rag_service.py
â”œâ”€â”€ templates
â”‚   â””â”€â”€ verdict.tex.j2
â””â”€â”€ view
    â”œâ”€â”€ console_view.py
    â””â”€â”€ file_view.py
```

## 4. UML
<img src="docs/llm_puml.png" width="900px">

## 5. Execution flow
```mermaid
sequenceDiagram
    participant User
    participant MainController
    participant ConsoleView
    participant QAService
    participant RagIndexService
    participant JuryService
    participant JuryCleanService
    participant LawyerService
    participant ProsecutorService
    participant JudgeService
    participant FileView

    User->>MainController: run(claim, data_folder)
    MainController->>ConsoleView: print_info("ì„¸ë¶€ ì§ˆë¬¸ ìƒì„± ì¤‘...")
    MainController->>QAService: generate_questions(claim)
    QAService-->>MainController: questions

    MainController->>ConsoleView: print_info("ë¦¬ì†ŒìŠ¤ ì„ë² ë”© ì¤‘...")
    MainController->>RagIndexService: embed_resources(data_folder)
    RagIndexService-->>MainController: resource

    MainController->>ConsoleView: print_info("ë°°ì‹¬ì›ë‹¨ í‰ê°€ ì¤‘...")
    MainController->>JuryService: evaluate(questions, resource, claim)
    JuryService-->>MainController: jury_results
    MainController->>FileView: write_json("jury_results.json")

    MainController->>ConsoleView: print_info("ë°°ì‹¬ì›ë‹¨ í‰ê°€ ì •ì œ ì¤‘...")
    MainController->>JuryCleanService: _clean("jury_results.json", model="gpt-3.5-turbo")
    JuryCleanService-->>MainController: cleaned_json
    MainController->>FileView: write_json("jury_results.json")

    MainController->>ConsoleView: print_info("ë³€í˜¸ì‚¬ ì˜ê²¬ ìƒì„± ì¤‘...")
    MainController->>LawyerService: analyze("jury_results.json", claim)
    LawyerService-->>MainController: lawyer_text
    MainController->>FileView: write_text("results/lawyer_results.txt")

    MainController->>ConsoleView: print_info("ê²€ì‚¬ ì˜ê²¬ ìƒì„± ì¤‘...")
    MainController->>ProsecutorService: analyze("jury_results.json", claim)
    ProsecutorService-->>MainController: prosecutor_text
    MainController->>FileView: write_text("results/prosecutor_results.txt")

    MainController->>ConsoleView: print_info("ê²€ì‚¬ê°€ ë³€í˜¸ì‚¬ ì˜ê²¬ ê²€í†  ì¤‘...")
    MainController->>ProsecutorService: reply_brief("results/lawyer_results.txt", claim)
    ProsecutorService-->>MainController: prosecutor_reply
    MainController->>FileView: write_text("reply_brief/prosecutor_reply_brief.txt")

    MainController->>ConsoleView: print_info("ë³€í˜¸ì‚¬ê°€ ê²€ì‚¬ ë¦¬í”Œë¼ì´ ê²€í†  ì¤‘...")
    MainController->>LawyerService: reply_brief("reply_brief/prosecutor_reply_brief.txt", claim)
    LawyerService-->>MainController: lawyer_reply
    MainController->>FileView: write_text("reply_brief/lawyer_reply_brief.txt")

    MainController->>ConsoleView: print_info("íŒì‚¬ ì˜ê²¬ ìƒì„± ì¤‘...")
    MainController->>JudgeService: prepare_input(...)
    JudgeService-->>MainController: judge_input
    MainController->>FileView: write_json("judge_input.json")

    MainController->>JudgeService: decide("judge_input.json")
    JudgeService-->>MainController: verdict
    MainController->>FileView: write_text("judge_verdict.txt")

    MainController->>ConsoleView: print_info("íŒê²°ë¬¸ PDF ìƒì„± ì¤‘...")
    MainController->>VerdictPdfService: generate(context)
    VerdictPdfService-->>MainController: verdict.pdf

```
